# /doc-review - 文档审查

## 描述

对工作流关键文档（需求、设计、任务）进行专业审查，确保文档完整清晰、逻辑严谨、为后续开发提供有力支撑。这是工作流中的重要 Gate 检查点。

## 使用方法

```
/doc-review                       # 审查当前阶段的文档
/doc-review Requirements.md       # 审查需求文档
/doc-review Design.md             # 审查设计文档
/doc-review Task.md               # 审查任务清单
```

## 文档审查规范

### 审查阶段

#### 第一阶段：需求审查 Gate

**命令**: `/doc-review Requirements.md`

**审查维度**:

1. **背景信息完整性**
   ```
   ☑ 项目背景清晰
   ☑ 用户场景描述充分
   ☑ 业务价值说明
   ☑ 约束条件列出
   ```

2. **功能需求清晰性**
   ```
   ☑ 功能需求用户故事（User Story）格式
   ☑ 每个需求都有清晰的验收标准
   ☑ 需求之间的关系和优先级明确
   ☑ 边界情况和异常流程说明

   示例:
   需求 REQ-001: 用户登录
   故事: 作为用户，我想用邮箱和用户名登录，以便访问系统
   验收标准:
   - [ ] 支持邮箱登录
   - [ ] 支持用户名登录
   - [ ] 登录失败显示清晰错误信息
   - [ ] 连续错误 5 次后锁定 15 分钟
   ```

3. **非功能需求定义**
   ```
   ☑ 性能要求明确（响应时间、吞吐量等）
   ☑ 安全要求定义（认证、授权、加密等）
   ☑ 可靠性要求（可用性、容错等）
   ☑ 兼容性要求（浏览器、设备等）
   ```

4. **优先级和范围**
   ```
   ☑ 需求优先级标记（高/中/低、MoSCoW 优先级）
   ☑ 明确 MVP（最小化可行产品）的范围
   ☑ 未来迭代的需求（如有）
   ☑ 明确的假设和依赖关系
   ```

5. **可衡量的验收标准**
   ```
   ☑ 验收标准具体、可度量
   ☑ 包含成功和失败场景
   ☑ 包含边界值测试
   ☑ 包含性能指标（如适用）
   ```

**输出示例**:
```
需求文档审查 - Requirements.md

【审查结果】

背景信息:      ✓ 完整
功能需求:      ✓ 清晰
非功能需求:    ⚠ 需要补充 (缺少性能要求)
优先级定义:    ✓ 明确
验收标准:      ✓ 具体可衡量

总体评分:      ⭐⭐⭐⭐ (良好)

【详细反馈】

1. 背景信息 - ✓ 通过
   ✓ 项目背景清晰
   ✓ 用户场景描述充分
   ✓ 业务价值明确

2. 功能需求 - ✓ 通过
   ✓ 7 个用户故事已列出
   ✓ 每个需求都有验收标准
   ✓ 用户登录、注册、忘记密码 3 个主要流程明确

3. 非功能需求 - ⚠ 需要改进
   ✓ 安全要求已定义（JWT 认证、bcrypt 密码加密）
   ⚠ 缺少性能要求（建议：登录响应时间 < 200ms）
   ⚠ 缺少可用性要求（建议：系统可用性 > 99.5%）

4. 优先级定义 - ✓ 通过
   ✓ 所有需求都有优先级标记
   ✓ MVP 范围清晰（用户认证功能）
   ✓ 第二版迭代规划（2FA、第三方登录）

5. 验收标准 - ✓ 通过
   ✓ 所有标准都具体可衡量
   ✓ 包含成功和失败场景
   ✓ 包含安全相关验收条件

【建议】

1. (优先级: 中) 补充性能需求
   位置: 非功能需求 - 性能
   建议:
   - 登录接口响应时间 < 200ms (p95)
   - 系统并发支持至少 1000 并发用户

2. (优先级: 低) 补充兼容性说明
   位置: 非功能需求 - 兼容性
   建议:
   - 支持现代浏览器（Chrome、Firefox、Safari 最新版）
   - 支持 iOS 和 Android 移动端

【下一步】

✓ 需求文档审查已完成
选择操作:
1. 确认通过 - 标记需求阶段完成（可进入设计阶段）
2. 采纳建议 - 完善需求文档后再审查
3. 记录为任务 - 将建议作为改进任务记录
```

---

#### 第二阶段：设计审查 Gate

**命令**: `/doc-review Design.md`

**审查维度**:

1. **架构设计完整性**
   ```
   ☑ 系统架构图清晰
   ☑ 主要模块职责明确
   ☑ 技术选型有正当理由
   ☑ 与需求的对应关系明确
   ```

2. **接口设计规范**
   ```
   ☑ API 接口定义完整（端点、方法、参数、返回）
   ☑ 数据模型定义清晰
   ☑ 错误处理规范一致
   ☑ 接口版本管理策略
   ```

3. **数据设计合理性**
   ```
   ☑ 数据表结构设计合理
   ☑ 数据关系和约束清晰
   ☑ 索引策略考虑
   ☑ 数据一致性保证
   ```

4. **安全设计**
   ```
   ☑ 认证方案清晰
   ☑ 授权机制定义
   ☑ 数据加密策略
   ☑ 防护措施（SQL 注入、XSS 等）
   ```

5. **扩展性和可维护性**
   ```
   ☑ 设计支持后续扩展
   ☑ 代码复用考虑
   ☑ 配置管理方案
   ☑ 监控和日志策略
   ```

---

#### 第三阶段：任务规划审查 Gate

**命令**: `/doc-review Task.md`

**审查维度**:

1. **任务拆分合理性**
   ```
   ☑ 主任务分解为适当大小的微任务（1-2 小时）
   ☑ 微任务之间没有重复
   ☑ 微任务覆盖了所有设计点
   ☑ 单一职责原则
   ```

2. **任务依赖关系**
   ```
   ☑ 任务依赖关系清晰
   ☑ 依赖路径合理（支持并行执行）
   ☑ 没有循环依赖
   ☑ 关键路径已标识
   ```

3. **验收标准清晰**
   ```
   ☑ 每个微任务都有明确的验收标准
   ☑ 验收标准具体可测试
   ☑ 包含单元测试要求
   ☑ 包含集成测试要求
   ```

4. **工时评估合理**
   ```
   ☑ 每个微任务预计工时合理
   ☑ 总工时符合项目规划
   ☑ 考虑了学习曲线和风险
   ```

5. **实现指导清晰**
   ```
   ☑ 修改文件清单明确
   ☑ 技术要点列出
   ☑ 测试策略说明
   ☑ 潜在风险标识
   ```

---

## 审查流程

### 标准流程

```
1. AI 读取文档
   ├─ 完整阅读当前审查的文档
   └─ 收集相关上下文（Requirements、Design、Task）

2. 多维度审查
   ├─ 检查内容完整性
   ├─ 检查逻辑一致性
   ├─ 检查可执行性
   └─ 检查与需求的对应关系

3. 生成审查报告
   ├─ 逐项打分
   ├─ 提出具体建议
   ├─ 标识改进优先级
   └─ 给出下一步指导

4. 用户审查报告
   ├─ 阅读 AI 的反馈
   ├─ 确认无误
   └─ 选择操作（通过、改进、记录）
```

## 相关文档

- `ai-workflow/INSTRUCTIONS.md` - 完整执行规范
- `Requirements.md` - 需求文档模板
- `Design.md` - 设计文档模板
- `Task.md` - 任务清单模板

## 注意事项

- 文档审查是 Gate 检查点，必须通过才能进入下一阶段
- 发现的问题应该立即反馈并改进，不要继续后续工作
- 审查不是为了挑剔，而是为了确保后续开发的顺利进行
- 对于重要建议，应该立即采纳；对于改进建议，可以记录为任务后续处理
- 同一阶段的文档可以一起审查（如需求和设计可以一起审查）
