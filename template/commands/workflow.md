# /workflow - 工作流管理

## 描述

管理工作流的创建、进入和状态查看。这是工作流系统的入口指令。

## 使用方法

```
/workflow
```

## 功能

1. **检测环境**：检查当前目录是否在工作流中
2. **创建工作流**：如果不在工作流中，提供创建新工作流的选项
3. **进入工作流**：选择并进入已有的工作流
4. **显示状态**：如果在工作流中，显示当前状态和进度

## 执行规范

请阅读 `ai-workflow/INSTRUCTIONS.md` 或 `INSTRUCTIONS.md` 中的 `/workflow` 章节，严格按照规范执行：

### 不在工作流中时

1. 扫描当前目录下的所有 `ai-workflow-*` 文件夹（排除 `ai-workflow-system`）
2. 显示选项菜单：
   - 选项 1：创建新工作流
   - 选项 2：进入已有工作流（如果存在）
3. 如果用户选择创建新工作流：
   - 询问工作流名称
   - 创建 `ai-workflow-{名称}` 文件夹
   - 初始化所有文档（Workflow.md、Requirements.md、Design.md、Task.md、BugList.md、TestCase.md）
   - 引导用户进入需求阶段

### 在工作流中时

1. 读取 `Workflow.md` 的 YAML frontmatter
2. 显示工作流状态：
   - 工作流名称
   - 当前阶段
   - 各阶段进度（需求、设计、任务、开发、测试）
3. 根据当前阶段提示下一步操作

## 示例输出

### 不在工作流中

```
检测到当前目录不在工作流中。

当前位置: <当前项目路径>

请选择操作：
1. 创建新工作流
2. 进入已有工作流

[用户选择 1]

请输入工作流名称（例如：user-auth）：
[用户输入：user-auth]

✓ 创建工作流文件夹：ai-workflow-user-auth/
✓ 初始化 Workflow.md (支持 YAML frontmatter)
✓ 创建 Requirements.md 模板
✓ 创建 Design.md 模板
✓ 创建 Task.md 模板 (支持微任务分解)
✓ 创建 BugList.md、TestCase.md 模板

工作流已创建！

======================================
工作流: 用户认证系统
======================================

当前阶段: requirements (需求分析)

下一步:
  1. 编写 Requirements.md - 清晰定义需求
  2. 执行 /doc-review - 审查需求文档
  3. 确认无误后，执行 /workflow 查看状态
```

### 在工作流中

```
======================================
工作流: 用户认证系统
======================================

【工作流概述】
描述: 实现用户登录、注册、密码重置功能
版本: 1.0 | 创建时间: 2024-01-06

【阶段进度】
  ✓ 需求分析 (completed)         - 2024-01-06 09:00
  ✓ 系统设计 (completed)         - 2024-01-06 14:30
  ○ 代码实现 (in-progress)       - 进行中
  - 测试验收 (not-started)       - 未开始
  - 上线部署 (not-started)       - 未开始

【任务统计】
  总任务数: 7 | 已完成: 3 | 进行中: 2 | 待开始: 2

【微任务统计】
  总微任务: 18 | 已完成: 6 | 进行中: 2 | 待开始: 10
  完成度: 33% (6/18)

  TASK-001: 用户登录功能 (100% 完成 3/3 微任务)
  ├─ ✓ TASK-001-1: 创建用户模型 (2024-01-06 10:20)
  ├─ ✓ TASK-001-2: 实现登录接口 (2024-01-06 12:30)
  └─ ✓ TASK-001-3: 添加限流保护 (2024-01-06 14:00)

  TASK-002: 用户注册功能 (进行中 1/3 微任务)
  ├─ ○ TASK-002-1: 创建注册表单 (进行中)
  ├─ - TASK-002-2: 发送验证邮件 (待开始)
  └─ - TASK-002-3: 邮件验证流程 (待开始)

  ...

【Git 统计】
  总提交数: 12
  最后提交: feat(TASK-001): 添加限流保护 (abc1234) - 2024-01-06 14:00
  当前分支: feature/auth-system

【Bug 统计】
  总 Bug: 3 | 待修复: 1 | 已修复: 2

【下一步】
  1. 执行 /dev TASK-002 --plan-only - 制定任务 002 的实现计划
  2. 审查计划后执行 /dev TASK-002 --execute - 实现任务
  3. 完成后执行 /code-review - 代码审查
  4. 全部完成后执行 /test - 运行测试

【快速命令】
  /dev TASK-002 --plan-only    制定任务 002 的实现计划
  /bug "描述"                  记录 Bug
  /test                        运行所有测试
  /doc-review                  审查文档
  /code-review                 代码审查
```

## 相关文档

- `ai-workflow/INSTRUCTIONS.md` - 完整的执行规范
- `templates/Workflow.md.template` - 工作流文档模板

## 注意事项

- 工作流文件夹必须以 `ai-workflow-` 开头
- 每个工作流都是独立的，互不干扰
- 工作流状态通过 `Workflow.md` 的 YAML frontmatter 管理
- 必须按照流程顺序执行：需求 → 设计 → 任务 → 开发 → 测试
